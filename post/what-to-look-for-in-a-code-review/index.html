<html>
  <head>
    <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>读书：《What to Look for in a Code Review》 | 江歌的博客</title>
<link rel="shortcut icon" href="https://Yixiaohan.github.io/favicon.ico?v=1722343434767">
<link href="https://cdn.jsdelivr.net/npm/remixicon@2.3.0/fonts/remixicon.css" rel="stylesheet">
<link rel="stylesheet" href="https://Yixiaohan.github.io/styles/main.css">
<link rel="alternate" type="application/atom+xml" title="读书：《What to Look for in a Code Review》 | 江歌的博客 - Atom Feed" href="https://Yixiaohan.github.io/atom.xml">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Droid+Serif:400,700">



    <meta name="description" content="[TOC]
What to Look for in a Code Review - Effective tips for reviewing code
各个组织对每个方面都有不同的优先级
你应该寻找什么
设计
·新代码如何适应整体架构？·代..." />
    <meta name="keywords" content="读书,Code Review" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
    <script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.5.1/build/highlight.min.js"></script>
  </head>
  <body>
    <div class="main">
      <div class="main-content">
        <div class="site-header">
  <a href="https://Yixiaohan.github.io">
  <img class="avatar" src="https://Yixiaohan.github.io/images/avatar.png?v=1722343434767" alt="">
  </a>
  <h1 class="site-title">
    江歌的博客
  </h1>
  <p class="site-description">
    温故而知新
  </p>
  <div class="menu-container">
    
      
        <a href="/" class="menu">
          首页
        </a>
      
    
      
        <a href="/archives" class="menu">
          归档
        </a>
      
    
      
        <a href="/tags" class="menu">
          标签
        </a>
      
    
      
        <a href="/post/about" class="menu">
          关于
        </a>
      
    
  </div>
  <div class="social-container">
    
      
    
      
    
      
    
      
    
      
    
  </div>
</div>

        <div class="post-detail">
          <article class="post">
            <h2 class="post-title">
              读书：《What to Look for in a Code Review》
            </h2>
            <div class="post-info">
              <span>
                2024-05-16
              </span>
              <span>
                9 min read
              </span>
              
                <a href="https://Yixiaohan.github.io/tag/vf2FtWC1P/" class="post-tag">
                  # 读书
                </a>
              
                <a href="https://Yixiaohan.github.io/tag/KgIVmm3tg/" class="post-tag">
                  # Code Review
                </a>
              
            </div>
            
            <div class="post-content-wrapper">
              <div class="post-content" v-pre>
                <p>[TOC]</p>
<h1 id="what-to-look-for-in-a-code-review-effective-tips-for-reviewing-code">What to Look for in a Code Review - Effective tips for reviewing code</h1>
<p><strong>各个组织对每个方面都有不同的优先级</strong></p>
<p>你应该寻找什么</p>
<h3 id="设计">设计</h3>
<p>·新代码如何适应整体架构？·代码是否遵循SOLID原则、领域驱动设计和/或团队喜欢的其他设计范式？</p>
<p>·新代码中使用了哪些设计模式？这些合适吗？·如果代码库混合了各种标准或设计风格，那么新代码是否遵循当前的实践？代码迁移的方向是正确的吗？还是遵循即将淘汰的旧代码的示例？</p>
<p>·代码是否在正确的位置？例如，如果代码与订单相关，它是否在订单服务中？</p>
<p>·新代码是否可以重用现有代码中的某些内容？新代码是否提供了一些我们可以在现有代码中重用的东西？新代码是否引入了重复？如果是这样的话，是否应该将其重构为更可重用的模式，或者在现阶段是否可以接受？·代码是否过度设计？它是否为现在不需要的可重用性而构建？团队如何平衡YAGNI¹的可重用性考虑因素？</p>
<h3 id="可读性和可维护性">可读性和可维护性·</h3>
<ul>
<li>
<p>（字段、变量、参数、方法和类的）名称实际上反映了它们所代表的东西吗？</p>
</li>
<li>
<p>我可以通过阅读代码来理解代码的作用吗？</p>
</li>
<li>
<p>我能理解这些测试是做什么的吗？</p>
</li>
<li>
<p>测试是否覆盖了良好的案例子集？它们是否涵盖了幸福的道路和例外的情况？还有没有考虑到的情况吗？</p>
</li>
<li>
<p>异常错误消息是否可以理解？</p>
</li>
<li>
<p>代码中容易混淆的部分是否有文档记录、注释，或由可理解的测试覆盖（根据团队偏好）？</p>
</li>
</ul>
<h3 id="功能性">功能性</h3>
<ul>
<li>
<p>代码是否真的做了它应该做的事情？如果有自动化测试来确保代码的正确性，那么这些测试真的测试出代码满足了约定的需求吗？</p>
</li>
<li>
<p>代码看起来是否包含细微的错误，比如使用了错误的变量进行检查，或者意外地使用了and而不是or？</p>
</li>
</ul>
<h3 id="你有没有想过">你有没有想过...</h3>
<ul>
<li>代码是否存在潜在的安全问题？</li>
<li>是否需要满足监管要求？</li>
<li>对于自动化性能测试未涵盖的区域，新代码是否引入了可避免的性能问题，例如对数据库或远程服务的不必要调用？</li>
<li>作者是否需要创建公共文档，或更改现有的帮助文件？</li>
<li>是否检查了面向用户的消息的正确性？</li>
<li>是否有明显的错误会使其在生产中停止工作？代码是否会意外地指向测试数据库，或者是否有一个硬编码的存根应该被替换为一个真实的的服务？</li>
<li></li>
</ul>
<h2 id="测试">测试</h2>
<h3 id="性能测试">性能测试</h3>
<h2 id="性能">性能</h2>
<h3 id="性能要求">性能要求</h3>
<p>在决定是否需要基于性能进行代码评审之前，我们应该问自己几个问题。</p>
<h3 id="这部分功能是否有严格的性能要求">这部分功能是否有严格的性能要求？</h3>
<p>正在审查的代码是否属于以前发布过SLA的领域？需求是否说明了所需的性能特征？</p>
<p>如果最初的需求是一个bug沿着“登录屏幕加载太慢”，那么最初的开发人员应该澄清什么是合适的加载时间--否则评审者或作者怎么能相信速度已经得到了充分的提高呢？</p>
<p>如果是这样，有没有测试证明它符合这些标准？</p>
<p>任何性能关键型系统都应该具有自动化的性能测试，以确保满足已发布的SLA（“在10毫秒内处理所有订单请求”）。如果没有这些，您将依赖用户通知您未能满足SLA。这不仅是一个糟糕的用户体验，而且可能导致可避免的罚款和费用。本系列的最后一篇文章详细介绍了代码审查测试。</p>
<h3 id="修复新功能是否对任何现有性能测试的结果产生了负面影响">修复/新功能是否对任何现有性能测试的结果产生了负面影响？</h3>
<h3 id="如果这个代码评审没有硬性的性能要求怎么办">如果这个代码评审没有硬性的性能要求怎么办？</h3>
<h3 id="服务应用程序外部的调用开销很大">服务/应用程序外部的调用开销很大</h3>
<h3 id="调用数据库">调用数据库</h3>
<h3 id="不必要的网络调用">不必要的网络调用</h3>
<h3 id="移动的可穿戴应用程序调用后端太多">移动的/可穿戴应用程序调用后端太多</h3>
<p>在移动的设备上，不必要的后端呼叫不仅会消耗您的性能，还会消耗您的电池寿命。</p>
<h3 id="高效和有效地使用资源">高效和有效地使用资源</h3>
<p>在我们如何使用网络资源之后，审查人员可以查看其他资源的使用情况，以确定可能的性能问题。</p>
<p>代码是否使用锁来访问共享资源？这是否会导致性能低下或死锁？</p>
<p>锁是性能杀手¹¹，在多线程环境中很难推理。考虑像这样的模式;仅具有写入/改变值的单个线程，而所有其他线程都可以自由读取;或使用无锁算法¹²。</p>
<h3 id="代码中是否存在可能导致内存泄漏的内容">代码中是否存在可能导致内存泄漏的内容？</h3>
<p>在Java中，一些常见的原因可能是：可变静态字段，使用ThreadLocal和使用ClassLoader¹³。</p>
<h3 id="应用程序的内存占用是否有可能无限增长">应用程序的内存占用是否有可能无限增长？</h3>
<p>作为一名审阅者，如果您看到不断向列表或映射添加新值，请询问列表或映射是否以及何时被丢弃或修剪</p>
<h3 id="代码是否关闭连接流">代码是否关闭连接/流？</h3>
<p>很容易忘记关闭连接或文件/网络流。当您查看他人的代码时，无论它使用的是哪种语言，如果正在使用文件、网络或数据库连接，请确保它正确关闭。</p>
<p>try-with-resources。</p>
<h3 id="是否正确配置了资源池">是否正确配置了资源池？</h3>
<h3 id="审阅者容易发现的警告标志">审阅者容易发现的警告标志</h3>
<p>某些类型的代码会立即提示潜在的性能问题。这将取决于所使用的语言和库（请在您的环境中的“代码气味”的注释中告诉我们）。</p>
<h3 id="反射">反射</h3>
<p>Java中的反射比没有反射的情况下做事情要慢。如果您正在检查包含反射的代码，请询问这是否绝对必需。</p>
<h3 id="timeouts-超时">Timeouts 超时</h3>
<p>当您检查代码时，您可能不知道操作的正确超时是多少，但您应该考虑“当这个超时计时时，对系统的其他部分有什么影响？”“.作为评审员，您应该考虑最坏的情况-应用程序是否在5分钟超时时间内阻塞？如果设置为1秒，最坏的情况是什么？如果代码的作者不能证明超时的长度是合理的，而你，审查者，不知道所选值的利弊，那么这是一个很好的时间让某人参与其中，了解其含义。不要等用户告诉你性能问题。</p>
<h3 id="parallelism">Parallelism</h3>
<p>代码是否使用多个线程来执行一个简单的操作？这是否会增加更多的时间和复杂性，而不是提高性能？使用现代Java，这可能比显式创建新线程更微妙：代码是否使用了Java 8闪亮的新并行流，但没有从并行性中受益？例如，在少量元素上或在执行非常简单操作的流上使用并行流可能比在顺序流上执行操作慢。</p>
<h2 id="正确性">正确性</h2>
<h3 id="代码是否在多线程环境中使用了正确的数据结构">代码是否在多线程环境中使用了正确的数据结构？</h3>
<h3 id="代码是否容易受到竞争条件的影响">代码是否容易受到竞争条件的影响？</h3>
<p>在多线程环境中使用时，编写可能导致微妙竞争条件的代码是非常容易的</p>
<h3 id="代码是否正确使用锁">代码是否正确使用锁？</h3>
<h3 id="代码的性能测试有价值吗">代码的性能测试有价值吗？</h3>
<p>例如，很容易编写糟糕的微基准测试²³。或者，如果测试使用的数据与生产数据完全不一样，它可能会给出误导性的结果。</p>
<h3 id="缓存">缓存</h3>
<p>虽然缓存可能是一种防止发出过多外部请求的方法，但它也有其自身的挑战。如果审查中的代码使用缓存，则应查找一些常见问题，例如缓存项无效的不正确</p>
<h2 id="代码级优化">代码级优化</h2>
<p>代码是否在不需要时使用同步/锁？如果代码总是在单个线程上运行，那么锁就是不必要的开销。</p>
<p>·代码是否在不需要的地方使用线程安全的数据结构？例如，Vector可以用ArrayList替换吗？</p>
<p>·代码使用的数据结构是否对常见操作性能较差？例如，使用链表，但需要定期搜索其中的单个项目。·当代码可以使用原子变量时，它是否使用锁或同步？·代码是否可以从延迟加载中受益？</p>
<p>·if语句或其他逻辑是否可以通过将最快的计算放在第一位而短路？·是否有很多字符串格式？这样能更有效率吗？</p>
<p>·日志记录语句是否使用字符串格式？它们是通过if来检查日志记录级别，还是使用延迟评估的供应商？</p>
<h2 id="数据结构">数据结构</h2>
<h3 id="lists-列表">Lists 列表</h3>
<h4 id="反模式太多的搜索">反模式：太多的搜索</h4>
<h4 id="反模式频繁重新排序">反模式：频繁重新排序</h4>
<h2 id="solid原则">SOLID原则</h2>
<h2 id="安全-与-隐私">安全 与 隐私</h2>
<ul>
<li>密码、apiToken</li>
<li>敏感数据暴露</li>
</ul>
<h2 id="upsource-quick-wins">Upsource Quick Wins</h2>
<h3 id="异常处理问题">异常处理问题</h3>
<h3 id="未使用代码">未使用代码</h3>

              </div>
              <div class="toc-container">
                <ul class="markdownIt-TOC">
<li><a href="#what-to-look-for-in-a-code-review-effective-tips-for-reviewing-code">What to Look for in a Code Review - Effective tips for reviewing code</a><br>
*
<ul>
<li><a href="#%E8%AE%BE%E8%AE%A1">设计</a></li>
<li><a href="#%E5%8F%AF%E8%AF%BB%E6%80%A7%E5%92%8C%E5%8F%AF%E7%BB%B4%E6%8A%A4%E6%80%A7">可读性和可维护性·</a></li>
<li><a href="#%E5%8A%9F%E8%83%BD%E6%80%A7">功能性</a></li>
<li><a href="#%E4%BD%A0%E6%9C%89%E6%B2%A1%E6%9C%89%E6%83%B3%E8%BF%87">你有没有想过...</a></li>
<li><a href="#%E6%B5%8B%E8%AF%95">测试</a>
<ul>
<li><a href="#%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95">性能测试</a></li>
</ul>
</li>
<li><a href="#%E6%80%A7%E8%83%BD">性能</a>
<ul>
<li><a href="#%E6%80%A7%E8%83%BD%E8%A6%81%E6%B1%82">性能要求</a></li>
<li><a href="#%E8%BF%99%E9%83%A8%E5%88%86%E5%8A%9F%E8%83%BD%E6%98%AF%E5%90%A6%E6%9C%89%E4%B8%A5%E6%A0%BC%E7%9A%84%E6%80%A7%E8%83%BD%E8%A6%81%E6%B1%82">这部分功能是否有严格的性能要求？</a></li>
<li><a href="#%E4%BF%AE%E5%A4%8D%E6%96%B0%E5%8A%9F%E8%83%BD%E6%98%AF%E5%90%A6%E5%AF%B9%E4%BB%BB%E4%BD%95%E7%8E%B0%E6%9C%89%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95%E7%9A%84%E7%BB%93%E6%9E%9C%E4%BA%A7%E7%94%9F%E4%BA%86%E8%B4%9F%E9%9D%A2%E5%BD%B1%E5%93%8D">修复/新功能是否对任何现有性能测试的结果产生了负面影响？</a></li>
<li><a href="#%E5%A6%82%E6%9E%9C%E8%BF%99%E4%B8%AA%E4%BB%A3%E7%A0%81%E8%AF%84%E5%AE%A1%E6%B2%A1%E6%9C%89%E7%A1%AC%E6%80%A7%E7%9A%84%E6%80%A7%E8%83%BD%E8%A6%81%E6%B1%82%E6%80%8E%E4%B9%88%E5%8A%9E">如果这个代码评审没有硬性的性能要求怎么办？</a></li>
<li><a href="#%E6%9C%8D%E5%8A%A1%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%A4%96%E9%83%A8%E7%9A%84%E8%B0%83%E7%94%A8%E5%BC%80%E9%94%80%E5%BE%88%E5%A4%A7">服务/应用程序外部的调用开销很大</a></li>
<li><a href="#%E8%B0%83%E7%94%A8%E6%95%B0%E6%8D%AE%E5%BA%93">调用数据库</a></li>
<li><a href="#%E4%B8%8D%E5%BF%85%E8%A6%81%E7%9A%84%E7%BD%91%E7%BB%9C%E8%B0%83%E7%94%A8">不必要的网络调用</a></li>
<li><a href="#%E7%A7%BB%E5%8A%A8%E7%9A%84%E5%8F%AF%E7%A9%BF%E6%88%B4%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B0%83%E7%94%A8%E5%90%8E%E7%AB%AF%E5%A4%AA%E5%A4%9A">移动的/可穿戴应用程序调用后端太多</a></li>
<li><a href="#%E9%AB%98%E6%95%88%E5%92%8C%E6%9C%89%E6%95%88%E5%9C%B0%E4%BD%BF%E7%94%A8%E8%B5%84%E6%BA%90">高效和有效地使用资源</a></li>
<li><a href="#%E4%BB%A3%E7%A0%81%E4%B8%AD%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8%E5%8F%AF%E8%83%BD%E5%AF%BC%E8%87%B4%E5%86%85%E5%AD%98%E6%B3%84%E6%BC%8F%E7%9A%84%E5%86%85%E5%AE%B9">代码中是否存在可能导致内存泄漏的内容？</a></li>
<li><a href="#%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E7%9A%84%E5%86%85%E5%AD%98%E5%8D%A0%E7%94%A8%E6%98%AF%E5%90%A6%E6%9C%89%E5%8F%AF%E8%83%BD%E6%97%A0%E9%99%90%E5%A2%9E%E9%95%BF">应用程序的内存占用是否有可能无限增长？</a></li>
<li><a href="#%E4%BB%A3%E7%A0%81%E6%98%AF%E5%90%A6%E5%85%B3%E9%97%AD%E8%BF%9E%E6%8E%A5%E6%B5%81">代码是否关闭连接/流？</a></li>
<li><a href="#%E6%98%AF%E5%90%A6%E6%AD%A3%E7%A1%AE%E9%85%8D%E7%BD%AE%E4%BA%86%E8%B5%84%E6%BA%90%E6%B1%A0">是否正确配置了资源池？</a></li>
<li><a href="#%E5%AE%A1%E9%98%85%E8%80%85%E5%AE%B9%E6%98%93%E5%8F%91%E7%8E%B0%E7%9A%84%E8%AD%A6%E5%91%8A%E6%A0%87%E5%BF%97">审阅者容易发现的警告标志</a></li>
<li><a href="#%E5%8F%8D%E5%B0%84">反射</a></li>
<li><a href="#timeouts-%E8%B6%85%E6%97%B6">Timeouts 超时</a></li>
<li><a href="#parallelism">Parallelism</a></li>
</ul>
</li>
<li><a href="#%E6%AD%A3%E7%A1%AE%E6%80%A7">正确性</a>
<ul>
<li><a href="#%E4%BB%A3%E7%A0%81%E6%98%AF%E5%90%A6%E5%9C%A8%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%8E%AF%E5%A2%83%E4%B8%AD%E4%BD%BF%E7%94%A8%E4%BA%86%E6%AD%A3%E7%A1%AE%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84">代码是否在多线程环境中使用了正确的数据结构？</a></li>
<li><a href="#%E4%BB%A3%E7%A0%81%E6%98%AF%E5%90%A6%E5%AE%B9%E6%98%93%E5%8F%97%E5%88%B0%E7%AB%9E%E4%BA%89%E6%9D%A1%E4%BB%B6%E7%9A%84%E5%BD%B1%E5%93%8D">代码是否容易受到竞争条件的影响？</a></li>
<li><a href="#%E4%BB%A3%E7%A0%81%E6%98%AF%E5%90%A6%E6%AD%A3%E7%A1%AE%E4%BD%BF%E7%94%A8%E9%94%81">代码是否正确使用锁？</a></li>
<li><a href="#%E4%BB%A3%E7%A0%81%E7%9A%84%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95%E6%9C%89%E4%BB%B7%E5%80%BC%E5%90%97">代码的性能测试有价值吗？</a></li>
<li><a href="#%E7%BC%93%E5%AD%98">缓存</a></li>
</ul>
</li>
<li><a href="#%E4%BB%A3%E7%A0%81%E7%BA%A7%E4%BC%98%E5%8C%96">代码级优化</a></li>
<li><a href="#%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84">数据结构</a>
<ul>
<li><a href="#lists-%E5%88%97%E8%A1%A8">Lists 列表</a>
<ul>
<li><a href="#%E5%8F%8D%E6%A8%A1%E5%BC%8F%E5%A4%AA%E5%A4%9A%E7%9A%84%E6%90%9C%E7%B4%A2">反模式：太多的搜索</a></li>
<li><a href="#%E5%8F%8D%E6%A8%A1%E5%BC%8F%E9%A2%91%E7%B9%81%E9%87%8D%E6%96%B0%E6%8E%92%E5%BA%8F">反模式：频繁重新排序</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#solid%E5%8E%9F%E5%88%99">SOLID原则</a></li>
<li><a href="#%E5%AE%89%E5%85%A8-%E4%B8%8E-%E9%9A%90%E7%A7%81">安全 与 隐私</a></li>
<li><a href="#upsource-quick-wins">Upsource Quick Wins</a>
<ul>
<li><a href="#%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%E9%97%AE%E9%A2%98">异常处理问题</a></li>
<li><a href="#%E6%9C%AA%E4%BD%BF%E7%94%A8%E4%BB%A3%E7%A0%81">未使用代码</a></li>
</ul>
</li>
</ul>
</li>
</ul>

              </div>
            </div>
          </article>
        </div>

        
          <div class="next-post">
            <div class="next">下一篇</div>
            <a href="https://Yixiaohan.github.io/post/lu-xing-qing-dan/">
              <h3 class="post-title">
                旅行清单
              </h3>
            </a>
          </div>
        

        

        <div class="site-footer">
  Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a>
  <a class="rss" href="https://Yixiaohan.github.io/atom.xml" target="_blank">
    <i class="ri-rss-line"></i> RSS
  </a>
</div>

      </div>
    </div>

    <script>
      hljs.initHighlightingOnLoad()

      let mainNavLinks = document.querySelectorAll(".markdownIt-TOC a");

      // This should probably be throttled.
      // Especially because it triggers during smooth scrolling.
      // https://lodash.com/docs/4.17.10#throttle
      // You could do like...
      // window.addEventListener("scroll", () => {
      //    _.throttle(doThatStuff, 100);
      // });
      // Only not doing it here to keep this Pen dependency-free.

      window.addEventListener("scroll", event => {
        let fromTop = window.scrollY;

        mainNavLinks.forEach((link, index) => {
          let section = document.getElementById(decodeURI(link.hash).substring(1));
          let nextSection = null
          if (mainNavLinks[index + 1]) {
            nextSection = document.getElementById(decodeURI(mainNavLinks[index + 1].hash).substring(1));
          }
          if (section.offsetTop <= fromTop) {
            if (nextSection) {
              if (nextSection.offsetTop > fromTop) {
                link.classList.add("current");
              } else {
                link.classList.remove("current");    
              }
            } else {
              link.classList.add("current");
            }
          } else {
            link.classList.remove("current");
          }
        });
      });

    </script>
  </body>
</html>
