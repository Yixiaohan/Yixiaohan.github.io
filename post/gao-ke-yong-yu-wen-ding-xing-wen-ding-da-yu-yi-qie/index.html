<html>
  <head>
    <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>高可用与稳定性--稳定大于一切 | 江歌的博客</title>
<link rel="shortcut icon" href="https://Yixiaohan.github.io/favicon.ico?v=1722343434767">
<link href="https://cdn.jsdelivr.net/npm/remixicon@2.3.0/fonts/remixicon.css" rel="stylesheet">
<link rel="stylesheet" href="https://Yixiaohan.github.io/styles/main.css">
<link rel="alternate" type="application/atom+xml" title="高可用与稳定性--稳定大于一切 | 江歌的博客 - Atom Feed" href="https://Yixiaohan.github.io/atom.xml">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Droid+Serif:400,700">



    <meta name="description" content="
稳定性之于系统，就像健康之于人类，看起来重要不紧急，然而一旦失去，就追悔莫及。


稳定性是一切 0 前面的 1。

名词解释：维基百科中的High availability
考虑维度：

基建、中间件的高可用（比如机房多活、数据库高可用..." />
    <meta name="keywords" content="高可用,稳定性" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
    <script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.5.1/build/highlight.min.js"></script>
  </head>
  <body>
    <div class="main">
      <div class="main-content">
        <div class="site-header">
  <a href="https://Yixiaohan.github.io">
  <img class="avatar" src="https://Yixiaohan.github.io/images/avatar.png?v=1722343434767" alt="">
  </a>
  <h1 class="site-title">
    江歌的博客
  </h1>
  <p class="site-description">
    温故而知新
  </p>
  <div class="menu-container">
    
      
        <a href="/" class="menu">
          首页
        </a>
      
    
      
        <a href="/archives" class="menu">
          归档
        </a>
      
    
      
        <a href="/tags" class="menu">
          标签
        </a>
      
    
      
        <a href="/post/about" class="menu">
          关于
        </a>
      
    
  </div>
  <div class="social-container">
    
      
    
      
    
      
    
      
    
      
    
  </div>
</div>

        <div class="post-detail">
          <article class="post">
            <h2 class="post-title">
              高可用与稳定性--稳定大于一切
            </h2>
            <div class="post-info">
              <span>
                2024-06-07
              </span>
              <span>
                8 min read
              </span>
              
                <a href="https://Yixiaohan.github.io/tag/VwYeq0QzXD/" class="post-tag">
                  # 高可用
                </a>
              
                <a href="https://Yixiaohan.github.io/tag/rlcTdLXtR7/" class="post-tag">
                  # 稳定性
                </a>
              
            </div>
            
            <div class="post-content-wrapper">
              <div class="post-content" v-pre>
                <blockquote>
<p>稳定性之于系统，就像健康之于人类，看起来重要不紧急，然而一旦失去，就追悔莫及。</p>
</blockquote>
<blockquote>
<p>稳定性是一切 0 前面的 1。</p>
</blockquote>
<p>名词解释：<a href="https://en.wikipedia.org/wiki/High_availability">维基百科中的High availability</a></p>
<p>考虑维度：</p>
<ul>
<li>基建、中间件的高可用（比如机房多活、数据库高可用等等）</li>
<li>业务服务的高可用</li>
</ul>
<p>SLA，服务等级协议（Service-Level Agreement，SLA）<br>
<img src="https://Yixiaohan.github.io/post-images/1721016869004.png" alt="" loading="lazy"></p>
<h2 id="1-事前防范">1. 事前防范</h2>
<h3 id="11-代码规约">1.1 代码规约</h3>
<ul>
<li>代码规约</li>
<li>数据库规约</li>
<li>Redis 规约</li>
<li>MQ 规约</li>
<li>其他规约</li>
</ul>
<p><strong>思考：有规约吗？有强制执行吗？不执行有惩罚吗？</strong></p>
<h3 id="12-变更管控">1.2 变更管控</h3>
<p><strong>思考：配置的变更有管控吗？</strong></p>
<h3 id="13-性能压测">1.3 性能压测</h3>
<ul>
<li>上线服务前考虑压测</li>
<li>大促活动前考虑压测</li>
</ul>
<h4 id="性能的测试指标主要有">性能的测试指标主要有：</h4>
<ul>
<li>响应时间：指应用执行一个操作需要的时间</li>
<li>并发数：指系统能够同时处理请求的数目</li>
<li>吞吐量：指单位时间内系统处理的请求数量</li>
<li>性能计数器：描述服务器或者操作系统性能的一些数据指标</li>
</ul>
<h4 id="性能测试方法">性能测试方法：</h4>
<ul>
<li>性能测试</li>
<li>负载测试</li>
<li>压力测试</li>
<li>稳定性测试</li>
</ul>
<h3 id="14-混沌工程">1.4 混沌工程</h3>
<h3 id="15-风险预案">1.5 风险预案</h3>
<ul>
<li>上线服务时技术方案考虑风险</li>
<li>大促活动前考虑风险</li>
<li>平常考虑风险预案</li>
</ul>
<h3 id="16-限流降级">1.6 限流降级</h3>
<h3 id="17-业务隔离">1.7 业务隔离</h3>
<h2 id="2-事中止血">2. 事中“止血”</h2>
<h3 id="21-监控告警">2.1 监控告警</h3>
<p>监控报警指标分为两种类型。</p>
<ol>
<li>系统要素指标：主要有 CPU、内存，和磁盘。</li>
<li>网络要素指标：主要有带宽、网络 I/O、CDN、DNS、安全策略、和负载策略。<br>
<img src="https://Yixiaohan.github.io/post-images/1721016507354.png" alt="" loading="lazy"><br>
<img src="https://Yixiaohan.github.io/post-images/1721016719850.png" alt="" loading="lazy"><br>
<img src="https://Yixiaohan.github.io/post-images/1721016733521.png" alt="" loading="lazy"><br>
<img src="https://Yixiaohan.github.io/post-images/1721016743277.png" alt="" loading="lazy"></li>
</ol>
<p>业务指标监控（比如订单量比昨天激增、退款数量、履约时效监控、发票开失败数量监控等等）</p>
<h3 id="22-异常巡检">2.2 异常巡检</h3>
<ul>
<li>巡检</li>
<li>值班</li>
</ul>
<h3 id="23-流量调度">2.3 流量调度</h3>
<h3 id="24-资损防控">2.4 资损防控</h3>
<h2 id="3-事后诊断">3. 事后诊断</h2>
<h3 id="31-系统诊断">3.1 系统诊断</h3>
<ul>
<li>CPU TOP 问题</li>
</ul>
<h3 id="32-jvm-诊断">3.2 JVM 诊断</h3>
<h4 id="321-异常诊断">3.2.1 异常诊断</h4>
<ul>
<li>
<p><a href="https://stabilityman.github.io/docs/diagnosis/jvm/exception/%E7%B3%BB%E7%BB%9F%E7%A8%B3%E5%AE%9A%E6%80%A7%E2%80%94%E2%80%94OutOfMemoryError%E5%B8%B8%E8%A7%81%E5%8E%9F%E5%9B%A0%E5%8F%8A%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95.html">OutOfMemoryError 常见原因及解决方法</a></p>
</li>
<li>
<p><a href="https://stabilityman.github.io/docs/diagnosis/jvm/exception/%E7%B3%BB%E7%BB%9F%E7%A8%B3%E5%AE%9A%E6%80%A7%E2%80%94%E2%80%94StackOverFlowError%E5%B8%B8%E8%A7%81%E5%8E%9F%E5%9B%A0%E5%8F%8A%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95.html">StackOverFlowError 常见原因及解决方法</a></p>
</li>
<li>
<p><a href="https://stabilityman.github.io/docs/diagnosis/jvm/exception/%E7%B3%BB%E7%BB%9F%E7%A8%B3%E5%AE%9A%E6%80%A7%E2%80%94%E2%80%94NoSuchMethodError%E5%B8%B8%E8%A7%81%E5%8E%9F%E5%9B%A0%E5%8F%8A%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95.html">NoSuchMethodError 常见原因及解决方法</a></p>
</li>
</ul>
<h4 id="322-内存诊断">3.2.2 内存诊断</h4>
<h4 id="323-线程诊断">3.2.3 线程诊断</h4>
<ul>
<li>线程池满</li>
<li>死锁</li>
</ul>
<h4 id="324-gc-诊断">3.2.4 GC 诊断</h4>
<p><a href="https://stabilityman.github.io/docs/diagnosis/jvm/gc/%E5%92%B1%E4%BB%AC%E4%BB%8E%E5%A4%B4%E5%88%B0%E5%B0%BE%E8%AF%B4%E4%B8%80%E6%AC%A1%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.html">咱们从头到尾说一次Java垃圾回收</a></p>
<h3 id="33-组件诊断">3.3 组件诊断</h3>
<p>Dubbo 常见错误及解决方法<br>
Nacos 常见问题及解决方法<br>
Spring Boot 常见错误及解决方法</p>
<h3 id="34-在线诊断">3.4 在线诊断</h3>
<p>Arthas</p>
<h3 id="35-链路追踪">3.5 链路追踪</h3>
<h3 id="36-rootcause">3.6 RootCause</h3>
<p><strong>思考</strong>：有 RCA 事故复盘文档的沉淀吗？</p>
<h1 id="其他-1">其他 1：</h1>
<h2 id="高可用">【高可用】</h2>
<p>设计一个高可用架构需要考虑多个方面，包括可用性、可靠性、性能、扩展性、安全性等。下面是一些设计高可用架构的一般性原则和方法：</p>
<ol>
<li>
<p><strong>设计集群架构</strong>：采用多节点的集群架构可以提高系统的可用性和可靠性，从而避免单点故障导致系统不可用。</p>
</li>
<li>
<p><strong>采用分布式架构</strong>：采用分布式架构可以将系统的负载分散到多个节点上，从而提高系统的性能和可扩展性。</p>
</li>
<li>
<p><strong>实现故障转移和容错机制</strong>：通过使用冗余组件、备份数据等技术手段，可以实现故障转移和容错机制。例如，采用主从复制、备份、快速切换等技术来确保数据不丢失、系统快速恢复。</p>
</li>
<li>
<p><strong>可靠的服务器和网络</strong>：选择可靠的服务器和网络设备，以确保它们能够在故障时正常运行。可以采用多个服务器进行冗余备份，以实现故障转移和负载均衡。可以选择高可靠性网络设备和路由器，以避免网络故障。</p>
</li>
<li>
<p><strong>容灾和备份</strong>：需要设置容灾和备份计划，以确保在自然灾害、人为错误或其他紧急情况下能够快速恢复服务。可以使用云备份和容灾服务，以提高备份和恢复的效率和可靠性。</p>
</li>
<li>
<p><strong>设计监控和自动化工具</strong>：通过使用监控工具和自动化工具可以实现对系统的实时监控和自动化维护。例如，通过使用系统监控工具、自动化运维工具等来实现自动化运维、自动化扩容等功能，从而减少手动操作和人为错误。</p>
</li>
<li>
<p><strong>实现数据安全保护</strong>：通过采用多层次的安全策略来保护数据的安全性。例如，使用加密技术、防火墙、入侵检测等技术来保护系统和数据的安全。</p>
</li>
<li>
<p><strong>进行容量规划和性能优化</strong>：通过进行容量规划和性能优化，可以提高系统的性能和可扩展性。例如，通过使用缓存、调整配置参数、优化代码等技术手段来提高系统的性能和稳定性。</p>
</li>
<li>
<p><strong>设计自动化扩容和弹性伸缩</strong>：通过设计自动化扩容和弹性伸缩功能，可以根据业务需求和系统负载情况来自动调整系统资源。例如，通过使用自动化扩容工具和自动化弹性伸缩策略来实现系统资源的自动分配和调整。</p>
</li>
</ol>
<p>需要注意的是，设计高可用架构需要综合考虑业务需求、技术方案、资源投入等因素，同时需要不断进行优化和改进，以实现最优的性能和可用性。</p>
<h1 id="其他2高可用与稳定性">其他2：高可用与稳定性</h1>
<ul>
<li><strong>解耦</strong>：是软件设计的关键，历数软件技术进化史是软件开发解耦的过程，介绍了组件和面向对象的低耦合原则。</li>
<li><strong>隔离</strong>：是物理上的分割，常见如微服务技术方案，需建立在低耦合基础上才有意义。</li>
<li><strong>异步</strong>：基于隔离进一步解耦，主要通过消息队列实现，以提高系统可用性。</li>
<li><strong>备份</strong>：解决硬件故障下系统的可用性，与失效转移成对出现，数据库备份需同步数据。</li>
<li><strong>重试</strong>：修复单次调用故障，但服务须是幂等的，否则有风险。</li>
<li><strong>熔断</strong>：针对不稳定或宕机服务器，通过断路器阻断调用，有三种状态。</li>
<li><strong>补偿</strong>：故障发生后弥补错误或避免损失扩大，典型场景是事务补偿。</li>
<li><strong>限流</strong>：在高并发场景下对系统进行保护，丢弃部分用户请求保证系统可用。</li>
<li><strong>降级</strong>：保护系统高可用，关闭非核心但压力大的功能，如电商系统的确认收货。</li>
<li><strong>多活</strong>：异地多活建立多个数据中心，用户请求通过域名解析分发，需解决数据冲突和同步问题。</li>
<li><strong>高可用运维方案</strong>：包括自动化测试减少 Bug、自动化监控发现故障、预发布验证和灰度发布降低影响。</li>
</ul>
<h1 id="其他3高可用与稳定性">其他3：高可用与稳定性</h1>
<p>保障集群高可用，主要从三个方面来入手：</p>
<ul>
<li>事前较多的是做全链路压测评，估峰值容量；周期性的集群健康性检查；随机故障演练（服务、机器、组件）。</li>
<li>事中做异常报警（性能、业务指标、可用性）；快速的故障定位（单机故障、集群故障、IDC故障、组件异常、服务异常）；故障前后的系统变更收集。</li>
<li>事后重点做系统回滚；扩容、限流、熔断、降级；核武器兜底。</li>
</ul>
<figure data-type="image" tabindex="1"><img src="https://Yixiaohan.github.io/post-images/1721889013017.png" alt="" loading="lazy"></figure>
<p>https://tech.meituan.com/2018/11/22/instant-logistics-distributed-system-architecture.html</p>
<h1 id="其他4高可用与稳定性">其他4：高可用与稳定性</h1>
<h2 id="多副本">多副本</h2>
<h2 id="隔离-限流-熔断-降级">隔离、限流、熔断、降级</h2>
<ul>
<li>限流注意事项：限流返回给客户端的错误代码、实时监控、实时配置</li>
<li>熔断注意事项：数据一致性、熔断监控、用户体验</li>
<li>降级注意事项：数据一致性、熔断监控、用户体验</li>
</ul>
<h2 id="灰度发布与回滚">灰度发布与回滚</h2>
<h2 id="监控体系-日志-报警">监控体系、日志、报警</h2>
<h2 id="故障处理原则">故障处理原则</h2>
<figure data-type="image" tabindex="2"><img src="https://Yixiaohan.github.io/post-images/1721016773015.png" alt="" loading="lazy"></figure>
<h1 id="阅读资料">阅读资料：</h1>
<p><a href="https://en.wikipedia.org/wiki/High_availability">维基百科中的High availability</a></p>
<p><a href="https://stabilityman.github.io/">https://stabilityman.github.io/</a></p>

              </div>
              <div class="toc-container">
                <ul class="markdownIt-TOC">
<li>
<ul>
<li><a href="#1-%E4%BA%8B%E5%89%8D%E9%98%B2%E8%8C%83">1. 事前防范</a>
<ul>
<li><a href="#11-%E4%BB%A3%E7%A0%81%E8%A7%84%E7%BA%A6">1.1 代码规约</a></li>
<li><a href="#12-%E5%8F%98%E6%9B%B4%E7%AE%A1%E6%8E%A7">1.2 变更管控</a></li>
<li><a href="#13-%E6%80%A7%E8%83%BD%E5%8E%8B%E6%B5%8B">1.3 性能压测</a>
<ul>
<li><a href="#%E6%80%A7%E8%83%BD%E7%9A%84%E6%B5%8B%E8%AF%95%E6%8C%87%E6%A0%87%E4%B8%BB%E8%A6%81%E6%9C%89">性能的测试指标主要有：</a></li>
<li><a href="#%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95%E6%96%B9%E6%B3%95">性能测试方法：</a></li>
</ul>
</li>
<li><a href="#14-%E6%B7%B7%E6%B2%8C%E5%B7%A5%E7%A8%8B">1.4 混沌工程</a></li>
<li><a href="#15-%E9%A3%8E%E9%99%A9%E9%A2%84%E6%A1%88">1.5 风险预案</a></li>
<li><a href="#16-%E9%99%90%E6%B5%81%E9%99%8D%E7%BA%A7">1.6 限流降级</a></li>
<li><a href="#17-%E4%B8%9A%E5%8A%A1%E9%9A%94%E7%A6%BB">1.7 业务隔离</a></li>
</ul>
</li>
<li><a href="#2-%E4%BA%8B%E4%B8%AD%E6%AD%A2%E8%A1%80">2. 事中“止血”</a>
<ul>
<li><a href="#21-%E7%9B%91%E6%8E%A7%E5%91%8A%E8%AD%A6">2.1 监控告警</a></li>
<li><a href="#22-%E5%BC%82%E5%B8%B8%E5%B7%A1%E6%A3%80">2.2 异常巡检</a></li>
<li><a href="#23-%E6%B5%81%E9%87%8F%E8%B0%83%E5%BA%A6">2.3 流量调度</a></li>
<li><a href="#24-%E8%B5%84%E6%8D%9F%E9%98%B2%E6%8E%A7">2.4 资损防控</a></li>
</ul>
</li>
<li><a href="#3-%E4%BA%8B%E5%90%8E%E8%AF%8A%E6%96%AD">3. 事后诊断</a>
<ul>
<li><a href="#31-%E7%B3%BB%E7%BB%9F%E8%AF%8A%E6%96%AD">3.1 系统诊断</a></li>
<li><a href="#32-jvm-%E8%AF%8A%E6%96%AD">3.2 JVM 诊断</a>
<ul>
<li><a href="#321-%E5%BC%82%E5%B8%B8%E8%AF%8A%E6%96%AD">3.2.1 异常诊断</a></li>
<li><a href="#322-%E5%86%85%E5%AD%98%E8%AF%8A%E6%96%AD">3.2.2 内存诊断</a></li>
<li><a href="#323-%E7%BA%BF%E7%A8%8B%E8%AF%8A%E6%96%AD">3.2.3 线程诊断</a></li>
<li><a href="#324-gc-%E8%AF%8A%E6%96%AD">3.2.4 GC 诊断</a></li>
</ul>
</li>
<li><a href="#33-%E7%BB%84%E4%BB%B6%E8%AF%8A%E6%96%AD">3.3 组件诊断</a></li>
<li><a href="#34-%E5%9C%A8%E7%BA%BF%E8%AF%8A%E6%96%AD">3.4 在线诊断</a></li>
<li><a href="#35-%E9%93%BE%E8%B7%AF%E8%BF%BD%E8%B8%AA">3.5 链路追踪</a></li>
<li><a href="#36-rootcause">3.6 RootCause</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#%E5%85%B6%E4%BB%96-1">其他 1：</a>
<ul>
<li><a href="#%E9%AB%98%E5%8F%AF%E7%94%A8">【高可用】</a></li>
</ul>
</li>
<li><a href="#%E5%85%B6%E4%BB%962%E9%AB%98%E5%8F%AF%E7%94%A8%E4%B8%8E%E7%A8%B3%E5%AE%9A%E6%80%A7">其他2：高可用与稳定性</a></li>
<li><a href="#%E5%85%B6%E4%BB%963%E9%AB%98%E5%8F%AF%E7%94%A8%E4%B8%8E%E7%A8%B3%E5%AE%9A%E6%80%A7">其他3：高可用与稳定性</a></li>
<li><a href="#%E5%85%B6%E4%BB%964%E9%AB%98%E5%8F%AF%E7%94%A8%E4%B8%8E%E7%A8%B3%E5%AE%9A%E6%80%A7">其他4：高可用与稳定性</a>
<ul>
<li><a href="#%E5%A4%9A%E5%89%AF%E6%9C%AC">多副本</a></li>
<li><a href="#%E9%9A%94%E7%A6%BB-%E9%99%90%E6%B5%81-%E7%86%94%E6%96%AD-%E9%99%8D%E7%BA%A7">隔离、限流、熔断、降级</a></li>
<li><a href="#%E7%81%B0%E5%BA%A6%E5%8F%91%E5%B8%83%E4%B8%8E%E5%9B%9E%E6%BB%9A">灰度发布与回滚</a></li>
<li><a href="#%E7%9B%91%E6%8E%A7%E4%BD%93%E7%B3%BB-%E6%97%A5%E5%BF%97-%E6%8A%A5%E8%AD%A6">监控体系、日志、报警</a></li>
<li><a href="#%E6%95%85%E9%9A%9C%E5%A4%84%E7%90%86%E5%8E%9F%E5%88%99">故障处理原则</a></li>
</ul>
</li>
<li><a href="#%E9%98%85%E8%AF%BB%E8%B5%84%E6%96%99">阅读资料：</a></li>
</ul>

              </div>
            </div>
          </article>
        </div>

        
          <div class="next-post">
            <div class="next">下一篇</div>
            <a href="https://Yixiaohan.github.io/post/wan-zi-chang-wen-qian-tan-xi-tong-wen-ding-xing-jian-she/">
              <h3 class="post-title">
                大厂文章阅读：万字长文浅谈系统稳定性建设
              </h3>
            </a>
          </div>
        

        

        <div class="site-footer">
  Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a>
  <a class="rss" href="https://Yixiaohan.github.io/atom.xml" target="_blank">
    <i class="ri-rss-line"></i> RSS
  </a>
</div>

      </div>
    </div>

    <script>
      hljs.initHighlightingOnLoad()

      let mainNavLinks = document.querySelectorAll(".markdownIt-TOC a");

      // This should probably be throttled.
      // Especially because it triggers during smooth scrolling.
      // https://lodash.com/docs/4.17.10#throttle
      // You could do like...
      // window.addEventListener("scroll", () => {
      //    _.throttle(doThatStuff, 100);
      // });
      // Only not doing it here to keep this Pen dependency-free.

      window.addEventListener("scroll", event => {
        let fromTop = window.scrollY;

        mainNavLinks.forEach((link, index) => {
          let section = document.getElementById(decodeURI(link.hash).substring(1));
          let nextSection = null
          if (mainNavLinks[index + 1]) {
            nextSection = document.getElementById(decodeURI(mainNavLinks[index + 1].hash).substring(1));
          }
          if (section.offsetTop <= fromTop) {
            if (nextSection) {
              if (nextSection.offsetTop > fromTop) {
                link.classList.add("current");
              } else {
                link.classList.remove("current");    
              }
            } else {
              link.classList.add("current");
            }
          } else {
            link.classList.remove("current");
          }
        });
      });

    </script>
  </body>
</html>
